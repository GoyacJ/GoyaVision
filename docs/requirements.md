# GoyaVision V1.0 需求文档

## 1. 项目定义

**GoyaVision** 是一个基于 AI 的智能媒体处理平台，提供媒体资产管理、算子编排、工作流自动化能力。

### 1.1 产品定位

- **智能媒体处理平台**：支持视频、图片、音频的 AI 分析与处理。
- **算子编排引擎**：基于版本化、多执行模式（HTTP/CLI/MCP/AIModel）的算子体系。
- **工作流自动化**：通过 DAG 工作流编排算子，实现复杂业务场景。
- **多租户与资产驱动**：统一管理媒体资产的全生命周期，支持租户隔离。

### 1.2 产品范围

| 模块 | 功能 |
|------|------|
| **资产库** | 媒体源管理、媒体资产管理、录制管理、存储配置 |
| **算子中心** | 算子管理（版本化）、算子市场、MCP 生态集成、AI 模型集成 |
| **任务中心** | 工作流编排（DAG）、任务调度、节点级执行追踪、产物管理 |
| **控制台** | 用户/角色/权限管理、系统分类配置、监控概览 |

## 2. 核心概念

### 2.1 MediaAsset（媒体资产）

媒体资产是系统中所有可被追踪、处理、复用的媒体实体。

**属性**：
- `type`：资产类型（video、image、audio）。注意：stream 已迁移至媒体源。
- `source_type`：来源类型（upload、generated、operator_output）。
- `visibility`：可见性控制（0: 私有, 1: 租户公开, 2: 系统公开）。
- `tenant_id` / `owner_id`：归属信息。

### 2.2 MediaSource（媒体源）

媒体源是流媒体资产的接入点，与 MediaMTX 路径一一对应。

**属性**：
- `type`：pull（拉流）、push（推流）。
- `protocol`：rtsp、rtmp、hls、webrtc、srt。
- `path_name`：MediaMTX 中的唯一标识路径。

### 2.3 Operator（算子）

算子是 AI/媒体处理的能力单元。V1.0 采用**版本化**与**多执行模式**设计。

**架构变更**：
- **Operator**：算子元数据、来源标识（Origin）、激活版本 ID、生命周期状态。
- **OperatorVersion**：执行模式（HTTP/CLI/MCP/AIModel）、执行配置、输入输出 Schema、变更日志。
- **Origin**：builtin（内置）、custom（自定义）、marketplace（市场）、mcp（MCP 工具）。
- **ExecMode**：
  - `http`：调用外部 REST API。
  - `cli`：执行本地命令行工具。
  - `mcp`：调用 MCP (Model Context Protocol) 工具。
  - `ai_model`：直接调用 AI 大模型（如 OpenAI/Ollama）。

### 2.4 Workflow（工作流）

通过 DAG（有向无环图）定义算子的执行顺序、参数配置与数据流转。

**触发器类型**：
- `manual`：手动触发。
- `schedule`：定时触发（cron 表达式）。
- `event`：事件驱动（asset_new、asset_done 等）。

### 2.5 Task（任务）

任务是工作流的一次执行实例。V1.0 支持**节点级执行追踪**。

**关键属性**：
- `node_executions`：记录每个节点的执行状态、起止时间、输入输出及错误详情。
- `progress`：基于 DAG 拓扑排序的实时进度百分比。

### 2.6 Artifact（产物）

产物是算子/工作流的输出结果。

**产物类型**：
- `asset`：新生成的资产。
- `result`：结构化结果（JSON）。
- `timeline`：时间轴片段。
- `report`：分析报告（新增）。

## 3. 功能需求

### 3.1 资产库（Asset Library）

- **流媒体深度集成**：通过媒体源（Sources）模块接入，支持实时预览、状态监控与录制。
- **资产管理**：支持 URL 与文件上传两种接入方式，自动生成标签与元数据。
- **可见性控制**：支持按租户和所有者进行细粒度权限控制。

### 3.2 算子中心（Operator Hub）

- **版本管理**：支持算子多版本并存，支持灰度激活与一键回滚。
- **MCP 集成**：支持从远程 MCP Server 同步工具并快速安装为本地算子。
- **AI 模型中心**：统一管理各厂商 AI 模型连接，支持在算子版本中直接引用。
- **Schema 门禁**：在创建、发布与编排环节强制进行 JSON Schema 合法性与连接兼容性校验。

### 3.3 任务中心（Task Center）

- **可视化编辑器**：基于 Vue Flow 的 DAG 编排工具，支持拖拽配置与自动布局。
- **执行引擎**：支持并行节点执行、重试机制（指数退避）与超时控制。
- **实时监控**：基于 SSE 的任务进度推送，详情页节点状态实时着色。

### 3.4 控制台（Console）

- **多租户体系**：支持租户级资源隔离与独立的可见性策略。
- **分类系统配置**：集中管理存储（MinIO）、媒体服务器（MediaMTX）、网络及 AI 厂商参数。
- **RBAC 增强**：支持自动角色分配与动态菜单权限。

## 4. 非功能需求

- **性能**：支持 DAG 的高效并发执行。
- **安全性**：API Key 字段加密存储，支持 RBAC 与租户隔离双重防护。
- **可扩展性**：支持通过 MCP 快速扩展算子能力。

---

最后更新：2026-02-08
