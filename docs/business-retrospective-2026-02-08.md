# GoyaVision 业务复盘总结（2026-02-08）

## 1. 复盘范围与方法

本次复盘面向当前主干实现，采用以下方法：

- 文档核对：`README.md`、`docs/requirements.md`、`docs/architecture.md`、`docs/api.md`、`docs/development-progress.md`。
- 代码核对：以后端真实路由、应用层命令查询、调度器、执行引擎、前端页面与 API 调用为准。
- 判定维度：业务价值、业务实用性、系统可用性、逻辑一致性。

## 2. 结论摘要

总体结论：项目方向正确、底座较强，但当前阶段更接近“可运行平台”而不是“可稳定运营产品”。

| 维度 | 结论 | 评分（10） |
|---|---|---|
| 价值 | AI 媒体编排方向明确，具备平台化潜力 | 8 |
| 实用 | 核心链路可跑，但运营链路存在断点 | 6 |
| 可用 | 前后端契约不一致导致认知和操作偏差 | 5 |
| 逻辑 | 引擎逻辑强，业务闭环仍有缺口 | 5 |

## 3. 保留价值（已形成的核心能力）

### 3.1 资产驱动的主链路成立

已形成“资产 -> 工作流 -> 任务 -> 产物”的主线模型，具备可追踪与可扩展基础。

### 3.2 执行引擎能力完整度较高

DAG 引擎具备并行、重试、超时、节点执行追踪与上下文补丁能力，是当前最稳健的价值核心。

### 3.3 模块化能力中心已具雏形

算子、算法、AI 模型、Agent Run Loop 已进入同一平台，具备后续“能力市场化”基础。

## 4. 关键问题清单（按优先级）

### P0（必须先修）

1. 工作流启停与调度未形成实时闭环  
启用/禁用工作流后未显式更新调度任务，调度主要依赖启动时加载。  
影响：新增启用的定时工作流无法及时生效，禁用回收不够及时。

2. 工作流状态语义前后端错位  
后端状态为 `draft/enabled/disabled`，前端大量按 `draft/testing/published/archived` 处理。  
影响：筛选、状态展示、启停按钮与真实状态不一致，直接影响可用性。

### P1（高优先）

3. `asset_done` 事件定义存在但发布链路缺失  
调度器已订阅 `asset_done`，但业务代码几乎未发布该事件。  
影响：事件触发工作流的设计能力与实际可用性不一致。

4. 任务 API 与真实执行链路割裂  
`/tasks/:id/start` 仅修改任务状态，不触发 DAG 执行。  
影响：任务中心中的“开始任务”更像管理动作，不是执行入口，容易误导。

5. 文档与实现存在偏差  
`docs/api.md` 未覆盖部分实际接口（注册、source preview、user assets、payment notify）。  
影响：研发协作、测试口径、集成联调成本增加。

6. 支付回调链路未闭环  
回调处理存在 TODO；回调路由注释与分组策略不一致；银联在适配器中未实现。  
影响：商业化模块可演示但不具备稳定运营条件。

7. 用户资产仓储租户隔离策略不一致  
`user_asset` 持久层未沿用主线 scope 策略。  
影响：多租户治理模型不统一，存在长期边界风险。

### P2（中优先）

8. 编辑器连线校验弱化  
前端连接逻辑偏“直接放行”，后端校验能力未在编辑阶段充分利用。  
影响：编辑期通过、运行期失败，降低编排体验。

9. API 返回封装不统一  
部分模块使用 envelope，部分直接返回实体，前端解包方式混用。  
影响：页面稳定性受调用细节影响，维护成本偏高。

## 5. 文档与代码一致性判断

### 一致项

- 资产库、算子中心、工作流、任务、Agent、算法等核心模块在代码层已完整落地。
- 调度器与 DAG 引擎具备文档描述的大多数能力。

### 不一致项

- API 文档覆盖不全（接口遗漏）。
- 进度文档中“支付能力已完成”与实现状态（银联未实现、回调逻辑未闭环）存在偏差。
- 工作流状态在前端语义与后端真实定义不一致。

## 6. 结论与建议

本项目“值得继续投入”，但应从“扩功能”切换为“补闭环”：

1. 先修平台一致性：状态枚举统一、调度联动、事件发布补齐、任务入口统一。  
2. 再修契约一致性：API 返回体规范化、文档自动化校验。  
3. 最后做商业化深化：将充值/订阅与任务消耗、配额控制、调用计量打通。

只有先把业务闭环和口径一致性补齐，项目才会从“技术可演示”跨到“业务可运营”。

---

最后更新：2026-02-08
