# api-doc

更新 API 文档的指南。当新增或修改 API 端点时使用。

## 更新文件

`docs/api.md`

## 文档结构

每个端点应包含：

1. **端点路径和方法**
2. **描述** - 端点的用途
3. **认证要求** - 是否需要 JWT Token
4. **权限要求** - RBAC 权限（如适用）
5. **请求参数** - Path、Query、Body 参数
6. **请求示例** - cURL 或 JSON 示例
7. **响应格式** - 成功响应和错误响应
8. **响应示例** - 实际的 JSON 响应
9. **错误码** - 可能的错误情况

## 端点文档模板

```markdown
### 获取媒体资产列表

**端点**: `GET /api/v1/assets`

**描述**: 获取媒体资产列表，支持分页和过滤。

**认证**: 需要 JWT Token

**权限**: `asset:list`

**Query 参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | 否 | 页码（默认 1） |
| page_size | int | 否 | 每页数量（默认 10） |
| type | string | 否 | 资产类型（video/image/audio） |
| source_type | string | 否 | 来源类型（stream/upload） |
| tags | string | 否 | 标签（逗号分隔） |

**请求示例**:
\`\`\`bash
curl -X GET "http://localhost:8080/api/v1/assets?page=1&page_size=10&type=video" \
  -H "Authorization: Bearer <token>"
\`\`\`

**响应示例**:
\`\`\`json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": "uuid",
        "name": "视频名称",
        "type": "video",
        "source_type": "stream",
        "tags": ["tag1", "tag2"],
        "created_at": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 10
  }
}
\`\`\`

**错误响应**:
| 错误码 | 说明 |
|--------|------|
| 401 | 未认证 |
| 403 | 无权限 |
| 400 | 参数错误 |
| 500 | 服务器错误 |
```

## 更新步骤

1. **定位章节** - 找到对应的 API 模块（如 媒体资产、算子、工作流）
2. **添加端点** - 按照模板格式添加新端点文档
3. **更新目录** - 在文档开头的目录中添加链接
4. **验证示例** - 确保请求/响应示例是真实有效的
5. **提交变更** - 提交时在 CHANGELOG 中注明 API 文档更新

## 注意事项

- 请求/响应示例必须真实可用
- 错误码要完整列出所有可能情况
- 权限标识要与代码中的权限定义一致
- 参数说明要清晰，包括类型、必填性、默认值
- 使用统一的响应格式（code, message, data）

## 快速参考

**通用响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

**通用错误码**:
- 200: 成功
- 400: 请求参数错误
- 401: 未认证
- 403: 无权限
- 404: 资源不存在
- 409: 资源冲突（如重复创建）
- 500: 服务器内部错误
