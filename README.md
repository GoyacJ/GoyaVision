# GoyaVision

<div align="center">

**ä¼ä¸šçº§ AI è§†é¢‘æµåˆ†æå¤„ç†å¹³å°**

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![Go Version](https://img.shields.io/badge/go-1.22+-00ADD8.svg)](https://golang.org/)
[![Go Report Card](https://goreportcard.com/badge/github.com/GoyaDo/GoyaVision)](https://goreportcard.com/report/github.com/GoyaDo/GoyaVision)

[åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜) â€¢ [API æ–‡æ¡£](#-api-æ–‡æ¡£) â€¢ [è´¡çŒ®](#-è´¡çŒ®)

</div>

---

GoyaVision æ˜¯ä¸€ä¸ªä¼ä¸šçº§ã€å¼€æºçš„ AI è§†é¢‘æµåˆ†æå¤„ç†å¹³å°ã€‚é›†æˆ MediaMTX æµåª’ä½“æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šåè®®è§†é¢‘æµæ¥å…¥ï¼ˆRTSP/RTMP/HLS/WebRTCï¼‰ã€æ™ºèƒ½æŠ½å¸§ã€è§†é¢‘å½•åˆ¶ä¸ç‚¹æ’­ã€AI æ¨¡å‹æ¨ç†ï¼Œä»¥åŠçµæ´»çš„ç®—æ³•è°ƒåº¦ç­–ç•¥ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¥ å¤šåè®®æµåª’ä½“

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **åè®®æ”¯æŒ** | RTSPã€RTMPã€HLSã€WebRTCã€SRT |
| **æµç±»å‹** | æ‹‰æµï¼ˆPullï¼‰- ä»æºåœ°å€æ‹‰å–ï¼›æ¨æµï¼ˆPushï¼‰- æ¥æ”¶å¤–éƒ¨æ¨é€ |
| **åè®®äº’è½¬** | è‡ªåŠ¨è½¬æ¢ï¼Œå•ä¸€æºå¤šåè®®åˆ†å‘ |
| **å®æ—¶çŠ¶æ€** | æµå°±ç»ªçŠ¶æ€ã€åœ¨çº¿çŠ¶æ€ã€è¯»å–è€…æ•°é‡ã€æµé‡ç»Ÿè®¡ |

### ğŸ¤– AI æ¨ç†å¼•æ“

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **ç®—æ³•ç»‘å®š** | ä¸€æµå¤šç®—æ³•ï¼Œçµæ´»ç»‘å®š |
| **æŠ½å¸§ç­–ç•¥** | å›ºå®šé—´éš”ï¼ˆ`interval_sec`ï¼‰ã€å®šæ—¶è°ƒåº¦ï¼ˆ`schedule`ï¼‰ |
| **å»¶è¿Ÿå¯åŠ¨** | æ”¯æŒ `initial_delay_sec` å»¶è¿Ÿé¦–æ¬¡æ‰§è¡Œ |
| **æ¨ç†é›†æˆ** | HTTP + JSON è°ƒç”¨å¤–éƒ¨ AI æœåŠ¡ |
| **ç»“æœæŒä¹…åŒ–** | æ¨ç†ç»“æœè½åº“ï¼Œæ”¯æŒæŸ¥è¯¢å’Œåˆ†é¡µ |

### ğŸ“¹ å½•åˆ¶ä¸ç‚¹æ’­

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **å½•åˆ¶æ ¼å¼** | fMP4ï¼ˆæ¨èï¼‰ã€MPEG-TS |
| **åˆ†æ®µå½•åˆ¶** | å¯é…ç½®æ®µæ—¶é•¿ï¼ˆé»˜è®¤ 1 å°æ—¶ï¼‰ |
| **å½•åˆ¶æ§åˆ¶** | æŒ‰æµå¯åœï¼Œç‹¬ç«‹äº AI åˆ†æ |
| **ç‚¹æ’­æ’­æ”¾** | HLS/MP4 ç‚¹æ’­ï¼Œæ”¯æŒ Seek è·³è½¬ |
| **æ–‡ä»¶ç´¢å¼•** | è‡ªåŠ¨ç´¢å¼•å½•åˆ¶æ®µï¼Œæä¾›æŸ¥è¯¢ API |

### ğŸ” è®¤è¯æˆæƒ

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **è®¤è¯æ–¹å¼** | JWT Tokenï¼ˆAccess + Refresh åŒ Tokenï¼‰ |
| **æƒé™æ¨¡å‹** | RBACï¼ˆç”¨æˆ·-è§’è‰²-æƒé™ï¼‰ |
| **èœå•ç®¡ç†** | åŠ¨æ€èœå•ï¼Œæ”¯æŒç›®å½•/èœå•/æŒ‰é’®ä¸‰çº§ |
| **æƒé™æ§åˆ¶** | æŒ‰é’®çº§æƒé™ï¼Œå‰ç«¯ `v-permission` æŒ‡ä»¤ |

### ğŸ–¥ï¸ Web ç®¡ç†ç•Œé¢

- Vue 3 + TypeScript + Element Plus
- æµç®¡ç†ï¼ˆå¤šåè®®é¢„è§ˆã€å½•åˆ¶æ§åˆ¶ï¼‰
- ç®—æ³•é…ç½®ä¸ç»‘å®š
- æ¨ç†ç»“æœå¯è§†åŒ–
- ç”¨æˆ·/è§’è‰²/èœå•ç®¡ç†
- å†…åµŒå¼éƒ¨ç½²ï¼ˆGo embedï¼‰

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

### ç™»å½•é¡µé¢

å®‰å…¨çš„ç”¨æˆ·è®¤è¯ï¼Œæ”¯æŒ JWT Token ç™»å½•ã€‚

![ç™»å½•é¡µé¢](docs/image/login.png)

### è§†é¢‘æµç®¡ç†

ç®¡ç†è§†é¢‘æµï¼Œæ”¯æŒæ‹‰æµ/æ¨æµã€å¤šåè®®é¢„è§ˆã€å½•åˆ¶å’Œç‚¹æ’­ã€‚

![è§†é¢‘æµç®¡ç†](docs/image/streams.png)

### ç®—æ³•ç®¡ç†

é…ç½® AI ç®—æ³•ï¼Œå®šä¹‰æ¨ç†æœåŠ¡ç«¯ç‚¹å’Œè¾“å…¥è¾“å‡ºè§„èŒƒã€‚

![ç®—æ³•ç®¡ç†](docs/image/algorithms.png)

### æ¨ç†ç»“æœ

æŸ¥è¯¢å’Œæµè§ˆ AI æ¨ç†ç»“æœï¼Œæ”¯æŒæŒ‰æµã€æ—¶é—´èŒƒå›´è¿‡æ»¤ã€‚

![æ¨ç†ç»“æœ](docs/image/inference-results.png)

### ç”¨æˆ·ç®¡ç†

ç®¡ç†ç³»ç»Ÿç”¨æˆ·ï¼Œæ”¯æŒè§’è‰²åˆ†é…å’ŒçŠ¶æ€æ§åˆ¶ã€‚

![ç”¨æˆ·ç®¡ç†](docs/image/user.png)

### è§’è‰²ç®¡ç†

åŸºäº RBAC çš„è§’è‰²æƒé™ç®¡ç†ï¼Œçµæ´»é…ç½®èœå•å’Œæ“ä½œæƒé™ã€‚

![è§’è‰²ç®¡ç†](docs/image/role.png)

### èœå•ç®¡ç†

åŠ¨æ€èœå•é…ç½®ï¼Œæ”¯æŒç›®å½•ã€èœå•ã€æŒ‰é’®ä¸‰çº§æƒé™æ§åˆ¶ã€‚

![èœå•ç®¡ç†](docs/image/menu.png)

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ· / è®¾å¤‡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RTSP æ¨æµ   â”‚       â”‚   RTMP æ¨æµ   â”‚       â”‚   Web ç•Œé¢    â”‚
â”‚   (æ‘„åƒå¤´)    â”‚       â”‚   (OBSç­‰)     â”‚       â”‚   (æµè§ˆå™¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MediaMTX                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RTSP   â”‚ â”‚  RTMP   â”‚ â”‚   HLS   â”‚ â”‚ WebRTC  â”‚ â”‚ Playback â”‚  â”‚
â”‚  â”‚  :8554  â”‚ â”‚  :1935  â”‚ â”‚  :8888  â”‚ â”‚  :8889  â”‚ â”‚  :9996   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          API :9997                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       GoyaVision                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    API Layer (:8080)                     â”‚   â”‚
â”‚  â”‚  Auth â”‚ Stream â”‚ Record â”‚ Preview â”‚ Playback â”‚ AI      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    App Layer                             â”‚   â”‚
â”‚  â”‚  StreamService â”‚ RecordService â”‚ PreviewService â”‚ ...   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Adapter Layer                          â”‚   â”‚
â”‚  â”‚  MediaMTX Client â”‚ PostgreSQL â”‚ FFmpeg â”‚ AI Inference   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PostgreSQL                                 â”‚
â”‚  streams â”‚ algorithms â”‚ bindings â”‚ records â”‚ results â”‚ users   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶èŒè´£

| ç»„ä»¶ | èŒè´£ |
|------|------|
| **GoyaVision** | ä¸šåŠ¡æ§åˆ¶å¹³é¢ï¼šæµç®¡ç†ã€å½•åˆ¶æ§åˆ¶ã€AI è°ƒåº¦ã€ç”¨æˆ·è®¤è¯ |
| **MediaMTX** | æ•°æ®å¹³é¢ï¼šåè®®è½¬æ¢ã€æµåˆ†å‘ã€å½•åˆ¶å­˜å‚¨ã€ç‚¹æ’­æœåŠ¡ |
| **PostgreSQL** | æŒä¹…åŒ–ï¼šæµé…ç½®ã€ç®—æ³•é…ç½®ã€æ¨ç†ç»“æœã€ç”¨æˆ·æ•°æ® |
| **FFmpeg** | AI æŠ½å¸§ï¼šä» MediaMTX RTSP ç«¯ç‚¹æå–å¸§ç”¨äºæ¨ç† |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/GoyaDo/GoyaVision.git
cd GoyaVision

# ä¸€é”®å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f goyavision
```

æœåŠ¡ç«¯å£ï¼š

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| GoyaVision | 8080 | Web ç•Œé¢å’Œ API |
| MediaMTX RTSP | 8554 | RTSP æµæ¥å…¥/è¾“å‡º |
| MediaMTX RTMP | 1935 | RTMP æµæ¥å…¥/è¾“å‡º |
| MediaMTX HLS | 8888 | HLS æ’­æ”¾ |
| MediaMTX WebRTC | 8889 | WebRTC æ’­æ”¾ |
| MediaMTX API | 9997 | MediaMTX æ§åˆ¶ API |
| PostgreSQL | 5432 | æ•°æ®åº“ |

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘

#### å‰ç½®è¦æ±‚

- Go 1.22+
- Node.js 18+
- PostgreSQL 12+
- FFmpegï¼ˆç”¨äº AI æŠ½å¸§ï¼‰
- MediaMTXï¼ˆæµåª’ä½“æœåŠ¡å™¨ï¼‰

#### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/GoyaDo/GoyaVision.git
cd GoyaVision

# 2. åˆ›å»ºæ•°æ®åº“
createdb goyavision

# 3. å¯åŠ¨ MediaMTX
# ä¸‹è½½: https://github.com/bluenviron/mediamtx/releases
mediamtx ./configs/mediamtx.yml

# 4. æ„å»ºå‰ç«¯
cd web && npm install && npm run build && cd ..

# 5. æ„å»ºåç«¯
go build -o bin/goyavision ./cmd/server

# 6. è¿è¡Œ
./bin/goyavision
```

### é»˜è®¤è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| admin | admin123 | è¶…çº§ç®¡ç†å‘˜ |

> âš ï¸ **å®‰å…¨æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

### è®¿é—®åœ°å€

- **Web ç•Œé¢**ï¼šhttp://localhost:8080
- **API æ–‡æ¡£**ï¼šhttp://localhost:8080/api/v1

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»é…ç½®æ–‡ä»¶ `configs/config.yaml`

```yaml
server:
  port: 8080

db:
  dsn: "host=localhost user=goyavision password=goyavision dbname=goyavision port=5432 sslmode=disable"

ffmpeg:
  bin: "ffmpeg"
  max_record: 16      # æœ€å¤§å½•åˆ¶å¹¶å‘ï¼ˆå·²ç”± MediaMTX å¤„ç†ï¼‰
  max_frame: 16       # æœ€å¤§æŠ½å¸§å¹¶å‘

ai:
  timeout: 10s
  retry: 2

jwt:
  secret: "your-secret-key-change-in-production"
  expire: 2h
  refresh_exp: 168h   # 7 å¤©
  issuer: "goyavision"

mediamtx:
  api_address: "http://localhost:9997"
  rtsp_address: "rtsp://localhost:8554"
  rtmp_address: "rtmp://localhost:1935"
  hls_address: "http://localhost:8888"
  webrtc_address: "http://localhost:8889"
  playback_address: "http://localhost:9996"
  record_path: "./data/recordings/%path/%Y-%m-%d_%H-%M-%S"
  record_format: "fmp4"           # fmp4 æˆ– mpegts
  segment_duration: "1h"
```

### ç¯å¢ƒå˜é‡è¦†ç›–

æ‰€æœ‰é…ç½®é¡¹éƒ½å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ï¼Œå‰ç¼€ä¸º `GOYAVISION_`ï¼š

```bash
export GOYAVISION_DB_DSN="host=localhost ..."
export GOYAVISION_JWT_SECRET="your-production-secret"
export GOYAVISION_MEDIAMTX_API_ADDRESS="http://mediamtx:9997"
```

### MediaMTX é…ç½® `configs/mediamtx.yml`

å…³é”®é…ç½®é¡¹ï¼š

```yaml
api: yes
apiAddress: :9997

rtsp: yes
rtspAddress: :8554

rtmp: yes
rtmpAddress: :1935

hls: yes
hlsAddress: :8888

webrtc: yes
webrtcAddress: :8889

playback: yes
playbackAddress: :9996

record: no  # é»˜è®¤å…³é—­ï¼Œç”± GoyaVision API æ§åˆ¶
recordPath: ./data/recordings/%path/%Y-%m-%d_%H-%M-%S
recordFormat: fmp4
```

## ğŸ“¡ æµåè®®åœ°å€

åˆ›å»ºæµåï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

| åè®® | åœ°å€æ ¼å¼ | ç”¨é€” |
|------|----------|------|
| RTSP | `rtsp://host:8554/{stream_name}` | ä½å»¶è¿Ÿæ’­æ”¾ã€VLC |
| RTMP | `rtmp://host:1935/{stream_name}` | OBS æ¨æµ/æ’­æ”¾ |
| HLS | `http://host:8888/{stream_name}/index.m3u8` | Web æ’­æ”¾ |
| WebRTC | `http://host:8889/{stream_name}/whep` | è¶…ä½å»¶è¿Ÿ Web æ’­æ”¾ |

**æ¨æµåœ°å€**ï¼ˆç”¨äº OBSã€FFmpeg ç­‰ï¼‰ï¼š

```bash
# RTSP æ¨æµ
ffmpeg -i input.mp4 -c copy -f rtsp rtsp://localhost:8554/mystream

# RTMP æ¨æµ
ffmpeg -i input.mp4 -c copy -f flv rtmp://localhost:1935/mystream
```

## ğŸ“š API æ–‡æ¡£

### API ç«¯ç‚¹æ¦‚è§ˆ

| æ¨¡å— | æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|------|
| **è®¤è¯** | POST | `/api/v1/auth/login` | ç™»å½• |
| | POST | `/api/v1/auth/refresh` | åˆ·æ–° Token |
| | POST | `/api/v1/auth/logout` | ç™»å‡º |
| | GET | `/api/v1/auth/profile` | è·å–å½“å‰ç”¨æˆ· |
| | PUT | `/api/v1/auth/password` | ä¿®æ”¹å¯†ç  |
| **æµç®¡ç†** | GET | `/api/v1/streams` | åˆ—è¡¨ï¼ˆæ”¯æŒ `with_status`ï¼‰ |
| | POST | `/api/v1/streams` | åˆ›å»ºæµ |
| | GET | `/api/v1/streams/:id` | è·å–è¯¦æƒ… |
| | PUT | `/api/v1/streams/:id` | æ›´æ–° |
| | DELETE | `/api/v1/streams/:id` | åˆ é™¤ |
| | POST | `/api/v1/streams/:id/enable` | å¯ç”¨ |
| | POST | `/api/v1/streams/:id/disable` | ç¦ç”¨ |
| | GET | `/api/v1/streams/:id/status` | è·å–å®æ—¶çŠ¶æ€ |
| **é¢„è§ˆ** | GET | `/api/v1/streams/:id/preview` | è·å–é¢„è§ˆ URL |
| | GET | `/api/v1/streams/:id/preview/ready` | æ£€æŸ¥æµå°±ç»ª |
| **å½•åˆ¶** | POST | `/api/v1/streams/:id/record/start` | å¼€å§‹å½•åˆ¶ |
| | POST | `/api/v1/streams/:id/record/stop` | åœæ­¢å½•åˆ¶ |
| | GET | `/api/v1/streams/:id/record/status` | å½•åˆ¶çŠ¶æ€ |
| | GET | `/api/v1/streams/:id/record/sessions` | å½•åˆ¶ä¼šè¯åˆ—è¡¨ |
| | GET | `/api/v1/streams/:id/record/files` | å½•åˆ¶æ–‡ä»¶åˆ—è¡¨ |
| **ç‚¹æ’­** | GET | `/api/v1/streams/:id/playback?start=` | è·å–ç‚¹æ’­ URL |
| | GET | `/api/v1/streams/:id/playback/segments` | å½•åˆ¶æ®µåˆ—è¡¨ |
| **ç®—æ³•** | CRUD | `/api/v1/algorithms` | ç®—æ³•ç®¡ç† |
| **ç»‘å®š** | CRUD | `/api/v1/streams/:id/algorithm-bindings` | ç®—æ³•ç»‘å®š |
| **æ¨ç†** | GET | `/api/v1/inference_results` | æ¨ç†ç»“æœæŸ¥è¯¢ |
| **ç”¨æˆ·** | CRUD | `/api/v1/users` | ç”¨æˆ·ç®¡ç† |
| **è§’è‰²** | CRUD | `/api/v1/roles` | è§’è‰²ç®¡ç† |
| **èœå•** | CRUD | `/api/v1/menus` | èœå•ç®¡ç† |

### è¯·æ±‚ç¤ºä¾‹

#### åˆ›å»ºæ‹‰æµ

```bash
curl -X POST http://localhost:8080/api/v1/streams \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "camera1",
    "url": "rtsp://192.168.1.100:554/stream",
    "type": "pull",
    "enabled": true
  }'
```

#### åˆ›å»ºæ¨æµï¼ˆç­‰å¾…å¤–éƒ¨æ¨é€ï¼‰

```bash
curl -X POST http://localhost:8080/api/v1/streams \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "obs_stream",
    "type": "push",
    "enabled": true
  }'
```

#### è·å–æµé¢„è§ˆ URL

```bash
curl http://localhost:8080/api/v1/streams/{id}/preview \
  -H "Authorization: Bearer {token}"

# å“åº”
{
  "hls_url": "http://localhost:8888/camera1/index.m3u8",
  "rtsp_url": "rtsp://localhost:8554/camera1",
  "rtmp_url": "rtmp://localhost:1935/camera1",
  "webrtc_url": "http://localhost:8889/camera1/whep"
}
```

è¯¦ç»† API æ–‡æ¡£è§ [API æ–‡æ¡£](docs/api.md)ã€‚

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ |
|------|------|
| **åç«¯** | Go 1.22, Echo v4, GORM, Viper, gocron/v2 |
| **æ•°æ®åº“** | PostgreSQL 12+ |
| **æµåª’ä½“** | MediaMTXï¼ˆRTSP/RTMP/HLS/WebRTC/SRTï¼‰ |
| **è§†é¢‘å¤„ç†** | FFmpegï¼ˆAI æŠ½å¸§ï¼‰ |
| **å‰ç«¯** | Vue 3, TypeScript, Vite, Element Plus, video.js |
| **è®¤è¯** | JWT (golang-jwt/jwt/v5), bcrypt |
| **éƒ¨ç½²** | Docker, Docker Compose |

## ğŸ“ é¡¹ç›®ç»“æ„

```
goyavision/
â”œâ”€â”€ cmd/server/              # åº”ç”¨å…¥å£
â”œâ”€â”€ config/                  # é…ç½®ç»“æ„å®šä¹‰
â”œâ”€â”€ configs/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml          # ä¸»é…ç½®
â”‚   â””â”€â”€ mediamtx.yml         # MediaMTX é…ç½®æ¨¡æ¿
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ domain/              # é¢†åŸŸå®ä½“
â”‚   â”œâ”€â”€ port/                # ç«¯å£æ¥å£
â”‚   â”œâ”€â”€ app/                 # åº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ adapter/             # é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ persistence/     # æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ mediamtx/        # MediaMTX å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ ai/              # AI æ¨ç†
â”‚   â””â”€â”€ api/                 # HTTP å±‚
â”‚       â”œâ”€â”€ handler/         # è¯·æ±‚å¤„ç†
â”‚       â”œâ”€â”€ dto/             # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚       â””â”€â”€ middleware/      # ä¸­é—´ä»¶
â”œâ”€â”€ pkg/ffmpeg/              # FFmpeg å°è£…
â”œâ”€â”€ web/                     # Vue 3 å‰ç«¯
â”œâ”€â”€ data/                    # è¿è¡Œæ—¶æ•°æ®
â”‚   â”œâ”€â”€ recordings/          # å½•åˆ¶æ–‡ä»¶
â”‚   â””â”€â”€ frames/              # AI æŠ½å¸§
â”œâ”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml       # Docker ç¼–æ’
â”œâ”€â”€ Dockerfile               # é•œåƒæ„å»º
â””â”€â”€ Makefile                 # æ„å»ºè„šæœ¬
```

## ğŸ“– æ–‡æ¡£

- [éœ€æ±‚æ–‡æ¡£](docs/requirements.md) - åŠŸèƒ½éœ€æ±‚å®šä¹‰
- [å¼€å‘è¿›åº¦](docs/development-progress.md) - å¼€å‘çŠ¶æ€ä¸è·¯çº¿å›¾
- [æ¶æ„æ–‡æ¡£](docs/architecture.md) - ç³»ç»Ÿæ¶æ„è¯´æ˜
- [API æ–‡æ¡£](docs/api.md) - RESTful API è¯¦ç»†æ–‡æ¡£
- [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT.md) - éƒ¨ç½²å’Œè¿ç»´
- [å˜æ›´æ—¥å¿—](CHANGELOG.md) - ç‰ˆæœ¬æ›´æ–°è®°å½•

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [è´¡çŒ®æŒ‡å—](CONTRIBUTING.md) äº†è§£å¦‚ä½•å‚ä¸ã€‚

- ğŸ› [æŠ¥å‘Š Bug](https://github.com/GoyaDo/GoyaVision/issues/new?template=bug_report.md)
- ğŸ’¡ [åŠŸèƒ½å»ºè®®](https://github.com/GoyaDo/GoyaVision/issues/new?template=feature_request.md)
- ğŸ“ [æ”¹è¿›æ–‡æ¡£](CONTRIBUTING.md#æ–‡æ¡£è´¡çŒ®)
- ğŸ’» [æäº¤ä»£ç ](CONTRIBUTING.md#æäº¤ä»£ç )

è¯·éµå¾ªæˆ‘ä»¬çš„ [è¡Œä¸ºå‡†åˆ™](CODE_OF_CONDUCT.md)ã€‚

## ğŸ”’ å®‰å…¨

å¦‚æœæ‚¨å‘ç°å®‰å…¨æ¼æ´ï¼Œè¯·æŸ¥çœ‹ [å®‰å…¨ç­–ç•¥](SECURITY.md) äº†è§£å¦‚ä½•æŠ¥å‘Šã€‚

**è¯·å‹¿**åœ¨å…¬å¼€ Issue ä¸­æŠ¥å‘Šå®‰å…¨é—®é¢˜ã€‚

## ğŸ“„ è®¸å¯è¯

[Apache License 2.0](LICENSE)

## ğŸ‘¤ ä½œè€…

**Goya**

- ç½‘ç«™: [www.ysmjjsy.com](https://www.ysmjjsy.com)
- é‚®ç®±: chenjie@ysmjjsy.com

## ğŸ“ è”ç³»

- **Issues**: [GitHub Issues](https://github.com/GoyaDo/GoyaVision/issues)
- **è®¨è®º**: [GitHub Discussions](https://github.com/GoyaDo/GoyaVision/discussions)
- **å®‰å…¨**: è§ [SECURITY.md](SECURITY.md)

---

<div align="center">

**GoyaVision** - è®© AI è§†é¢‘åˆ†ææ›´ç®€å•ã€æ›´å¼ºå¤§

[â­ Star us on GitHub](https://github.com/GoyaDo/GoyaVision) â€¢ [ğŸ“– é˜…è¯»æ–‡æ¡£](docs/requirements.md) â€¢ [ğŸ¤ å‚ä¸è´¡çŒ®](CONTRIBUTING.md)

</div>
